"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _resolver = _interopRequireDefault(require("./resolver"));

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

const validateNode = (node, definition, ctx) => {
  if (node && definition && definition.validators) {
    // TODO: enable this validation when completed with all allowed fields in validators
    // const allowedChildren = [
    //   ...(Object.keys(definition.properties || {})),
    //   ...(Object.keys(definition.validators || {})),
    // ];
    // Object.keys(node).forEach((field) => {
    //   ctx.path.push(field);
    //   if (!allowedChildren.includes(field) && field.indexOf('x-') !== 0) {
    //     ctx.result.push(createError('This field is not permitted here', node, ctx, 'key'));
    //   }
    //   ctx.path.pop();
    // });
    Object.keys(definition.validators).forEach(v => {
      if (Object.keys(node).includes(v)) ctx.path.push(v);
      const validationResult = definition.validators[v]()(node, ctx);
      if (Object.keys(node).includes(v)) ctx.path.pop();
      if (validationResult) ctx.result.push(validationResult);
    });
  }
};

const traverseNode = (node, definition, ctx) => {
  const currentPath = ctx.path.join('/'); // TO-DO: refactor ctx.visited into dictionary for O(1) check time

  if (ctx.visited.includes(currentPath)) return;
  ctx.visited.push(currentPath);
  if (!node || !definition) return; // console.log(`Current path: ${currentPath}`);

  let nextPath;
  let prevPath;
  let resolvedNode; // eslint-disable-next-line prefer-const

  ({
    node: resolvedNode,
    nextPath
  } = (0, _resolver.default)(node, ctx));

  if (nextPath) {
    ctx.pathStack.push(ctx.path);
    prevPath = ctx.path;
    ctx.path = nextPath.replace('#/', '').split('/');
  }

  if (Array.isArray(resolvedNode)) {
    resolvedNode.forEach((nodeChild, i) => {
      ctx.path.push(i);
      traverseNode(nodeChild, definition, ctx);
      ctx.path.pop();
    });
    if (nextPath) ctx.path = prevPath;
    return;
  }

  validateNode(resolvedNode, definition, ctx);

  if (definition.properties) {
    let nodeChildres;

    switch (typeof definition.properties) {
      case 'function':
        nodeChildres = definition.properties(resolvedNode);
        Object.keys(nodeChildres).forEach(child => {
          if (Object.keys(resolvedNode).includes(child)) {
            ctx.path.push(child);
            if (resolvedNode[child]) traverseNode(resolvedNode[child], nodeChildres[child], ctx);
            ctx.path.pop();
          }
        });
        break;

      case 'object':
        Object.keys(definition.properties).forEach(p => {
          ctx.path.push(p);

          if (typeof definition.properties[p] === 'function') {
            if (resolvedNode[p]) traverseNode(resolvedNode[p], definition.properties[p](), ctx);
          } else if (node[p]) {
            traverseNode(resolvedNode[p], definition.properties[p], ctx);
          }

          ctx.path.pop();
        });
        break;

      default:
        break;
    }
  }

  if (nextPath) ctx.path = ctx.pathStack.pop();
};

const traverse = (node, definition, sourceFile) => {
  const ctx = {
    document: node,
    path: [],
    visited: [],
    result: [],
    pathStack: [],
    source: sourceFile
  };
  traverseNode(node, definition, ctx);
  return ctx.result;
};

var _default = traverse;
exports.default = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy90cmF2ZXJzZS5qcyJdLCJuYW1lcyI6WyJ2YWxpZGF0ZU5vZGUiLCJub2RlIiwiZGVmaW5pdGlvbiIsImN0eCIsInZhbGlkYXRvcnMiLCJPYmplY3QiLCJrZXlzIiwiZm9yRWFjaCIsInYiLCJpbmNsdWRlcyIsInBhdGgiLCJwdXNoIiwidmFsaWRhdGlvblJlc3VsdCIsInBvcCIsInJlc3VsdCIsInRyYXZlcnNlTm9kZSIsImN1cnJlbnRQYXRoIiwiam9pbiIsInZpc2l0ZWQiLCJuZXh0UGF0aCIsInByZXZQYXRoIiwicmVzb2x2ZWROb2RlIiwicGF0aFN0YWNrIiwicmVwbGFjZSIsInNwbGl0IiwiQXJyYXkiLCJpc0FycmF5Iiwibm9kZUNoaWxkIiwiaSIsInByb3BlcnRpZXMiLCJub2RlQ2hpbGRyZXMiLCJjaGlsZCIsInAiLCJ0cmF2ZXJzZSIsInNvdXJjZUZpbGUiLCJkb2N1bWVudCIsInNvdXJjZSJdLCJtYXBwaW5ncyI6Ijs7Ozs7OztBQUFBOzs7O0FBRUEsTUFBTUEsWUFBWSxHQUFHLENBQUNDLElBQUQsRUFBT0MsVUFBUCxFQUFtQkMsR0FBbkIsS0FBMkI7QUFDOUMsTUFBSUYsSUFBSSxJQUFJQyxVQUFSLElBQXNCQSxVQUFVLENBQUNFLFVBQXJDLEVBQWlEO0FBQy9DO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUVBQyxJQUFBQSxNQUFNLENBQUNDLElBQVAsQ0FBWUosVUFBVSxDQUFDRSxVQUF2QixFQUFtQ0csT0FBbkMsQ0FBNENDLENBQUQsSUFBTztBQUNoRCxVQUFJSCxNQUFNLENBQUNDLElBQVAsQ0FBWUwsSUFBWixFQUFrQlEsUUFBbEIsQ0FBMkJELENBQTNCLENBQUosRUFBbUNMLEdBQUcsQ0FBQ08sSUFBSixDQUFTQyxJQUFULENBQWNILENBQWQ7QUFDbkMsWUFBTUksZ0JBQWdCLEdBQUdWLFVBQVUsQ0FBQ0UsVUFBWCxDQUFzQkksQ0FBdEIsSUFBMkJQLElBQTNC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QUFFLEVBRkk7QUFHVlEsSUFBQUEsT0FBTyxFQUFFLEVBSEM7QUFJVkosSUFBQUEsTUFBTSxFQUFFLEVBSkU7QUFLVlEsSUFBQUEsU0FBUyxFQUFFLEVBTEQ7QUFNVmMsSUFBQUEsTUFBTSxFQUFFRjtBQU5FLEdBQVo7QUFRQW5CLEVBQUFBLFlBQVksQ0FBQ2QsSUFBRCxFQUFPQyxVQUFQLEVBQW1CQyxHQUFuQixDQUFaO0FBQ0EsU0FBT0EsR0FBRyxDQUFDVyxNQUFYO0FBQ0QsQ0FYRDs7ZUFhZW1CLFEiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgcmVzb2x2ZU5vZGUgZnJvbSAnLi9yZXNvbHZlcic7XG5cbmNvbnN0IHZhbGlkYXRlTm9kZSA9IChub2RlLCBkZWZpbml0aW9uLCBjdHgpID0+IHtcbiAgaWYgKG5vZGUgJiYgZGVmaW5pdGlvbiAmJiBkZWZpbml0aW9uLnZhbGlkYXRvcnMpIHtcbiAgICAvLyBUT0RPOiBlbmFibGUgdGhpcyB2YWxpZGF0aW9uIHdoZW4gY29tcGxldGVkIHdpdGggYWxsIGFsbG93ZWQgZmllbGRzIGluIHZhbGlkYXRvcnNcbiAgICAvLyBjb25zdCBhbGxvd2VkQ2hpbGRyZW4gPSBbXG4gICAgLy8gICAuLi4oT2JqZWN0LmtleXMoZGVmaW5pdGlvbi5wcm9wZXJ0aWVzIHx8IHt9KSksXG4gICAgLy8gICAuLi4oT2JqZWN0LmtleXMoZGVmaW5pdGlvbi52YWxpZGF0b3JzIHx8IHt9KSksXG4gICAgLy8gXTtcbiAgICAvLyBPYmplY3Qua2V5cyhub2RlKS5mb3JFYWNoKChmaWVsZCkgPT4ge1xuICAgIC8vICAgY3R4LnBhdGgucHVzaChmaWVsZCk7XG5cbiAgICAvLyAgIGlmICghYWxsb3dlZENoaWxkcmVuLmluY2x1ZGVzKGZpZWxkKSAmJiBmaWVsZC5pbmRleE9mKCd4LScpICE9PSAwKSB7XG4gICAgLy8gICAgIGN0eC5yZXN1bHQucHVzaChjcmVhdGVFcnJvcignVGhpcyBmaWVsZCBpcyBub3QgcGVybWl0dGVkIGhlcmUnLCBub2RlLCBjdHgsICdrZXknKSk7XG4gICAgLy8gICB9XG5cbiAgICAvLyAgIGN0eC5wYXRoLnBvcCgpO1xuICAgIC8vIH0pO1xuXG4gICAgT2JqZWN0LmtleXMoZGVmaW5pdGlvbi52YWxpZGF0b3JzKS5mb3JFYWNoKCh2KSA9PiB7XG4gICAgICBpZiAoT2JqZWN0LmtleXMobm9kZSkuaW5jbHVkZXModikpIGN0eC5wYXRoLnB1c2godik7XG4gICAgICBjb25zdCB2YWxpZGF0aW9uUmVzdWx0ID0gZGVmaW5pdGlvbi52YWxpZGF0b3JzW3ZdKCkobm9kZSwgY3R4KTtcbiAgICAgIGlmIChPYmplY3Qua2V5cyhub2RlKS5pbmNsdWRlcyh2KSkgY3R4LnBhdGgucG9wKCk7XG4gICAgICBpZiAodmFsaWRhdGlvblJlc3VsdCkgY3R4LnJlc3VsdC5wdXNoKHZhbGlkYXRpb25SZXN1bHQpO1xuICAgIH0pO1xuICB9XG59O1xuXG5jb25zdCB0cmF2ZXJzZU5vZGUgPSAobm9kZSwgZGVmaW5pdGlvbiwgY3R4KSA9PiB7XG4gIGNvbnN0IGN1cnJlbnRQYXRoID0gY3R4LnBhdGguam9pbignLycpO1xuXG4gIC8vIFRPLURPOiByZWZhY3RvciBjdHgudmlzaXRlZCBpbnRvIGRpY3Rpb25hcnkgZm9yIE8oMSkgY2hlY2sgdGltZVxuICBpZiAoY3R4LnZpc2l0ZWQuaW5jbHVkZXMoY3VycmVudFBhdGgpKSByZXR1cm47XG4gIGN0eC52aXNpdGVkLnB1c2goY3VycmVudFBhdGgpO1xuXG4gIGlmICghbm9kZSB8fCAhZGVmaW5pdGlvbikgcmV0dXJuO1xuXG4gIC8vIGNvbnNvbGUubG9nKGBDdXJyZW50IHBhdGg6ICR7Y3VycmVudFBhdGh9YCk7XG4gIGxldCBuZXh0UGF0aDtcbiAgbGV0IHByZXZQYXRoO1xuICBsZXQgcmVzb2x2ZWROb2RlO1xuICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgcHJlZmVyLWNvbnN0XG4gICh7IG5vZGU6IHJlc29sdmVkTm9kZSwgbmV4dFBhdGggfSA9IHJlc29sdmVOb2RlKG5vZGUsIGN0eCkpO1xuICBpZiAobmV4dFBhdGgpIHtcbiAgICBjdHgucGF0aFN0YWNrLnB1c2goY3R4LnBhdGgpO1xuICAgIHByZXZQYXRoID0gY3R4LnBhdGg7XG4gICAgY3R4LnBhdGggPSBuZXh0UGF0aC5yZXBsYWNlKCcjLycsICcnKS5zcGxpdCgnLycpO1xuICB9XG5cbiAgaWYgKEFycmF5LmlzQXJyYXkocmVzb2x2ZWROb2RlKSkge1xuICAgIHJlc29sdmVkTm9kZS5mb3JFYWNoKChub2RlQ2hpbGQsIGkpID0+IHtcbiAgICAgIGN0eC5wYXRoLnB1c2goaSk7XG4gICAgICB0cmF2ZXJzZU5vZGUobm9kZUNoaWxkLCBkZWZpbml0aW9uLCBjdHgpO1xuICAgICAgY3R4LnBhdGgucG9wKCk7XG4gICAgfSk7XG4gICAgaWYgKG5leHRQYXRoKSBjdHgucGF0aCA9IHByZXZQYXRoO1xuICAgIHJldHVybjtcbiAgfVxuXG4gIHZhbGlkYXRlTm9kZShyZXNvbHZlZE5vZGUsIGRlZmluaXRpb24sIGN0eCk7XG5cbiAgaWYgKGRlZmluaXRpb24ucHJvcGVydGllcykge1xuICAgIGxldCBub2RlQ2hpbGRyZXM7XG4gICAgc3dpdGNoICh0eXBlb2YgZGVmaW5pdGlvbi5wcm9wZXJ0aWVzKSB7XG4gICAgICBjYXNlICdmdW5jdGlvbic6XG4gICAgICAgIG5vZGVDaGlsZHJlcyA9IGRlZmluaXRpb24ucHJvcGVydGllcyhyZXNvbHZlZE5vZGUpO1xuXG4gICAgICAgIE9iamVjdC5rZXlzKG5vZGVDaGlsZHJlcykuZm9yRWFjaCgoY2hpbGQpID0+IHtcbiAgICAgICAgICBpZiAoT2JqZWN0LmtleXMocmVzb2x2ZWROb2RlKS5pbmNsdWRlcyhjaGlsZCkpIHtcbiAgICAgICAgICAgIGN0eC5wYXRoLnB1c2goY2hpbGQpO1xuICAgICAgICAgICAgaWYgKHJlc29sdmVkTm9kZVtjaGlsZF0pIHRyYXZlcnNlTm9kZShyZXNvbHZlZE5vZGVbY2hpbGRdLCBub2RlQ2hpbGRyZXNbY2hpbGRdLCBjdHgpO1xuICAgICAgICAgICAgY3R4LnBhdGgucG9wKCk7XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgJ29iamVjdCc6XG5cbiAgICAgICAgT2JqZWN0LmtleXMoZGVmaW5pdGlvbi5wcm9wZXJ0aWVzKS5mb3JFYWNoKChwKSA9PiB7XG4gICAgICAgICAgY3R4LnBhdGgucHVzaChwKTtcbiAgICAgICAgICBpZiAodHlwZW9mIGRlZmluaXRpb24ucHJvcGVydGllc1twXSA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgICAgaWYgKHJlc29sdmVkTm9kZVtwXSkgdHJhdmVyc2VOb2RlKHJlc29sdmVkTm9kZVtwXSwgZGVmaW5pdGlvbi5wcm9wZXJ0aWVzW3BdKCksIGN0eCk7XG4gICAgICAgICAgfSBlbHNlIGlmIChub2RlW3BdKSB7XG4gICAgICAgICAgICB0cmF2ZXJzZU5vZGUocmVzb2x2ZWROb2RlW3BdLCBkZWZpbml0aW9uLnByb3BlcnRpZXNbcF0sIGN0eCk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGN0eC5wYXRoLnBvcCgpO1xuICAgICAgICB9KTtcblxuICAgICAgICBicmVhaztcbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIGJyZWFrO1xuICAgIH1cbiAgfVxuICBpZiAobmV4dFBhdGgpIGN0eC5wYXRoID0gY3R4LnBhdGhTdGFjay5wb3AoKTtcbn07XG5cbmNvbnN0IHRyYXZlcnNlID0gKG5vZGUsIGRlZmluaXRpb24sIHNvdXJjZUZpbGUpID0+IHtcbiAgY29uc3QgY3R4ID0ge1xuICAgIGRvY3VtZW50OiBub2RlLFxuICAgIHBhdGg6IFtdLFxuICAgIHZpc2l0ZWQ6IFtdLFxuICAgIHJlc3VsdDogW10sXG4gICAgcGF0aFN0YWNrOiBbXSxcbiAgICBzb3VyY2U6IHNvdXJjZUZpbGUsXG4gIH07XG4gIHRyYXZlcnNlTm9kZShub2RlLCBkZWZpbml0aW9uLCBjdHgpO1xuICByZXR1cm4gY3R4LnJlc3VsdDtcbn07XG5cbmV4cG9ydCBkZWZhdWx0IHRyYXZlcnNlO1xuIl19