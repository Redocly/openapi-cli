"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _error = _interopRequireDefault(require("./error"));

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

const resolve = (link, ctx) => {
  const steps = link.replace('#/', '').split('/');
  let target = ctx.document;
  Object.keys(steps).forEach(step => {
    target = steps[step] && target[steps[step]] ? target[steps[step]] : null;
  });
  return target;
};

const resolveNode = (node, ctx) => {
  if (!node || typeof node !== 'object') return {
    node,
    nextPath: null
  };
  let nextPath;
  let resolved = node;
  Object.keys(node).forEach(p => {
    if (p === '$ref') {
      nextPath = node.$ref;
      resolved = resolve(node[p], ctx);

      if (!resolved) {
        ctx.result.push((0, _error.default)('Refernce does not exist', node, ctx));
        resolved = node;
      }
    }
  });
  return {
    node: resolved,
    nextPath
  };
};

var _default = resolveNode;
exports.default = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9yZXNvbHZlci5qcyJdLCJuYW1lcyI6WyJyZXNvbHZlIiwibGluayIsImN0eCIsInN0ZXBzIiwicmVwbGFjZSIsInNwbGl0IiwidGFyZ2V0IiwiZG9jdW1lbnQiLCJPYmplY3QiLCJrZXlzIiwiZm9yRWFjaCIsInN0ZXAiLCJyZXNvbHZlTm9kZSIsIm5vZGUiLCJuZXh0UGF0aCIsInJlc29sdmVkIiwicCIsIiRyZWYiLCJyZXN1bHQiLCJwdXNoIl0sIm1hcHBpbmdzIjoiOzs7Ozs7O0FBQUE7Ozs7QUFFQSxNQUFNQSxPQUFPLEdBQUcsQ0FBQ0MsSUFBRCxFQUFPQyxHQUFQLEtBQWU7QUFDN0IsUUFBTUMsS0FBSyxHQUFHRixJQUFJLENBQUNHLE9BQUwsQ0FBYSxJQUFiLEVBQW1CLEVBQW5CLEVBQXVCQyxLQUF2QixDQUE2QixHQUE3QixDQUFkO0FBQ0EsTUFBSUMsTUFBTSxHQUFHSixHQUFHLENBQUNLLFFBQWpCO0FBQ0FDLEVBQUFBLE1BQU0sQ0FBQ0MsSUFBUCxDQUFZTixLQUFaLEVBQW1CTyxPQUFuQixDQUE0QkMsSUFBRCxJQUFVO0FBQ25DTCxJQUFBQSxNQUFNLEdBQUdILEtBQUssQ0FBQ1EsSUFBRCxDQUFMLElBQWVMLE1BQU0sQ0FBQ0gsS0FBSyxDQUFDUSxJQUFELENBQU4sQ0FBckIsR0FBcUNMLE1BQU0sQ0FBQ0gsS0FBSyxDQUFDUSxJQUFELENBQU4sQ0FBM0MsR0FBMkQsSUFBcEU7QUFDRCxHQUZEO0FBR0EsU0FBT0wsTUFBUDtBQUNELENBUEQ7O0FBU0EsTUFBTU0sV0FBVyxHQUFHLENBQUNDLElBQUQsRUFBT1gsR0FBUCxLQUFlO0FBQ2pDLE1BQUksQ0FBQ1csSUFBRCxJQUFTLE9BQU9BLElBQVAsS0FBZ0IsUUFBN0IsRUFBdUMsT0FBTztBQUFFQSxJQUFBQSxJQUFGO0FBQVFDLElBQUFBLFFBQVEsRUFBRTtBQUFsQixHQUFQO0FBQ3ZDLE1BQUlBLFFBQUo7QUFDQSxNQUFJQyxRQUFRLEdBQUdGLElBQWY7QUFDQUwsRUFBQUEsTUFBTSxDQUFDQyxJQUFQLENBQVlJLElBQVosRUFBa0JILE9BQWxCLENBQTJCTSxDQUFELElBQU87QUFDL0IsUUFBSUEsQ0FBQyxLQUFLLE1BQVYsRUFBa0I7QUFDaEJGLE1BQUFBLFFBQVEsR0FBR0QsSUFBSSxDQUFDSSxJQUFoQjtBQUNBRixNQUFBQSxRQUFRLEdBQUdmLE9BQU8sQ0FBQ2EsSUFBSSxDQUFDRyxDQUFELENBQUwsRUFBVWQsR0FBVixDQUFsQjs7QUFDQSxVQUFJLENBQUNhLFFBQUwsRUFBZTtBQUNiYixRQUFBQSxHQUFHLENBQUNnQixNQUFKLENBQVdDLElBQVgsQ0FBZ0Isb0JBQVkseUJBQVosRUFBdUNOLElBQXZDLEVBQTZDWCxHQUE3QyxDQUFoQjtBQUNBYSxRQUFBQSxRQUFRLEdBQUdGLElBQVg7QUFDRDtBQUNGO0FBQ0YsR0FURDtBQVVBLFNBQU87QUFBRUEsSUFBQUEsSUFBSSxFQUFFRSxRQUFSO0FBQWtCRCxJQUFBQTtBQUFsQixHQUFQO0FBQ0QsQ0FmRDs7ZUFpQmVGLFciLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgY3JlYXRlRXJyb3IgZnJvbSAnLi9lcnJvcic7XG5cbmNvbnN0IHJlc29sdmUgPSAobGluaywgY3R4KSA9PiB7XG4gIGNvbnN0IHN0ZXBzID0gbGluay5yZXBsYWNlKCcjLycsICcnKS5zcGxpdCgnLycpO1xuICBsZXQgdGFyZ2V0ID0gY3R4LmRvY3VtZW50O1xuICBPYmplY3Qua2V5cyhzdGVwcykuZm9yRWFjaCgoc3RlcCkgPT4ge1xuICAgIHRhcmdldCA9IHN0ZXBzW3N0ZXBdICYmIHRhcmdldFtzdGVwc1tzdGVwXV0gPyB0YXJnZXRbc3RlcHNbc3RlcF1dIDogbnVsbDtcbiAgfSk7XG4gIHJldHVybiB0YXJnZXQ7XG59O1xuXG5jb25zdCByZXNvbHZlTm9kZSA9IChub2RlLCBjdHgpID0+IHtcbiAgaWYgKCFub2RlIHx8IHR5cGVvZiBub2RlICE9PSAnb2JqZWN0JykgcmV0dXJuIHsgbm9kZSwgbmV4dFBhdGg6IG51bGwgfTtcbiAgbGV0IG5leHRQYXRoO1xuICBsZXQgcmVzb2x2ZWQgPSBub2RlO1xuICBPYmplY3Qua2V5cyhub2RlKS5mb3JFYWNoKChwKSA9PiB7XG4gICAgaWYgKHAgPT09ICckcmVmJykge1xuICAgICAgbmV4dFBhdGggPSBub2RlLiRyZWY7XG4gICAgICByZXNvbHZlZCA9IHJlc29sdmUobm9kZVtwXSwgY3R4KTtcbiAgICAgIGlmICghcmVzb2x2ZWQpIHtcbiAgICAgICAgY3R4LnJlc3VsdC5wdXNoKGNyZWF0ZUVycm9yKCdSZWZlcm5jZSBkb2VzIG5vdCBleGlzdCcsIG5vZGUsIGN0eCkpO1xuICAgICAgICByZXNvbHZlZCA9IG5vZGU7XG4gICAgICB9XG4gICAgfVxuICB9KTtcbiAgcmV0dXJuIHsgbm9kZTogcmVzb2x2ZWQsIG5leHRQYXRoIH07XG59O1xuXG5leHBvcnQgZGVmYXVsdCByZXNvbHZlTm9kZTtcbiJdfQ==